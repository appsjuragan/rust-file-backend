
// Bulk delete endpoint - add this to the end of files.rs before the last closing brace

#[utoipa::path(
    post,
    path = "/files/bulk-delete",
    request_body = BulkDeleteRequest,
    responses(
        (status = 200, description = "Items deleted", body = BulkDeleteResponse),
        (status = 401, description = "Unauthorized"),
        (status = 400, description = "Bad request")
    ),
    security(
        ("jwt" = [])
    )
)]
pub async fn bulk_delete(
    State(state): State<crate::AppState>,
    Extension(claims): Extension<Claims>,
    Json(req): Json<BulkDeleteRequest>,
) -> Result<Json<BulkDeleteResponse>, (StatusCode, String)> {
    use crate::services::storage_lifecycle::StorageLifecycleService;

    if req.item_ids.is_empty() {
        return Err((StatusCode::BAD_REQUEST, "No items provided".to_string()));
    }

    let deleted_count = StorageLifecycleService::bulk_delete(
        &state.db,
        &state.storage,
        &claims.sub,
        req.item_ids,
    )
    .await
    .map_err(|e| {
        tracing::error!("Bulk delete failed: {}", e);
        (StatusCode::INTERNAL_SERVER_ERROR, e.to_string())
    })?;

    Ok(Json(BulkDeleteResponse { deleted_count }))
}
